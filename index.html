<!DOCTYPE html>
<html>
<head>


</head>


<body>
<!-- ========================================= -->
<!-- cut here to embed in the squareSpace site -->

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" rel="stylesheet">

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>
<div style="text-align:center;" class="jumbotron text-center">
  <h1 class="display-3">Testing Pen Data</h1>
  <p class="lead">
    Try sending data to the pen spreadsheet using URL query parameters.
  </p>
</div>

<script>

let testObject = [{}];

function getUrlVars()
{
        var vars = [], hash;
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++)
        {
                hash = hashes[i].split('=');                        
                vars[hash[0]] = hash[1];
        }
        return vars;

}


var url_vars = getUrlVars();
for(var i in url_vars)
{
  let q = i.replace(/!/g,'=');    
  let question = q.replace(/#/g,' ');
  let space = url_vars[i].replace(/%20/g, ' ');
      let answer = space.replace(/%40/g, '@');
      testObject.push({"name":question, "value":answer});
} 

console.log(testObject);

let postUrl = 'https://script.google.com/macros/s/AKfycbwLqdeuIVWdOpDwO1_NebeF_ylpNbUZRZ7axRo5zZfVpMXl9AWjaBf85wdlgOGnUxAfeA/exec';

// output the content of the JS Array that has been stringified (so we can see it in the console) 
console.log(testObject);
  $.ajax({
    url: postUrl, // google sheet url
    headers: { 
    'Content-Type': 'application/x-www-form-urlencoded',
    'Access-Control-Allow-Origin': '*'
    },
    method: "GET",
    dataType: "json",
    data: testObject, // JS array
    success: function(data){
      console.log(data.result);
      if (data.result = "success") {
        // show custom msg or do other stuff for the user to see, eg show message on web page
        console.log("successfully posted to google sheet");
      };
    },
    error: function(data){
      console.log("fail");
    }
});


//urlParams.append('status', 'true')) //returns ?q=losAngeles&country=US&status=true

</script>
<!-- cut here to embed in the squareSpace site -->
<!-- ========================================= -->

</body>


</html>